version: '3.8'

services:
  web:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DJANGO_SETTINGS_MODULE=_core.settings
      - SECRET_KEY=django-insecure-production-key-change-this
      - DEBUG=False
      - ALLOWED_HOSTS=localhost,127.0.0.1,yourdomain.com
      - DATABASE_URL=sqlite:///db.sqlite3
      - STRIPE_PUBLIC_KEY=pk_live_your_key_here
      - STRIPE_SECRET_KEY=sk_live_your_key_here
      - STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here
      - EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
      - EMAIL_HOST=smtp.gmail.com
      - EMAIL_PORT=587
      - EMAIL_USE_TLS=True
      - EMAIL_HOST_USER=your-email@gmail.com
      - EMAIL_HOST_PASSWORD=your-app-password
    volumes:
      - .:/app
      - staticfiles:/app/staticfiles
      - media:/app/media
    depends_on:
      - db
    command: gunicorn _core.wsgi:application --bind 0.0.0.0:8000

  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=debtprofile
      - POSTGRES_USER=debtprofile
      - POSTGRES_PASSWORD=securepassword
    volumes:
      - postgres_data:/var/lib/postgresql/data

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - staticfiles:/app/staticfiles
      - media:/app/media
      - ./ssl:/etc/ssl/certs
    depends_on:
      - web

volumes:
  postgres_data:
  staticfiles:
  media: