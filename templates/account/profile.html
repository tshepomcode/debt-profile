{% extends 'base/base.html' %}

{% block title %}Profile - Debt Profile{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-base-content">Account Profile</h1>
        <p class="text-base-content/70 mt-2">Manage your account settings and preferences</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Profile Information -->
        <div class="lg:col-span-2">
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Profile Information</h2>

                    <form method="post" action="{% url 'account_email' %}" class="space-y-4">
                        {% csrf_token %}

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Email Address</span>
                            </label>
                            <input
                                type="email"
                                name="email"
                                value="{{ user.email }}"
                                class="input input-bordered"
                                readonly
                            >
                            <label class="label">
                                <span class="label-text-alt">
                                    To change your email, please contact support
                                </span>
                            </label>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Account Type</span>
                            </label>
                            <input
                                type="text"
                                value="{% if user.subscription.is_active %}Premium{% else %}Free{% endif %}"
                                class="input input-bordered"
                                readonly
                            >
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Member Since</span>
                            </label>
                            <input
                                type="text"
                                value="{{ user.date_joined|date:'F j, Y' }}"
                                class="input input-bordered"
                                readonly
                            >
                        </div>
                    </form>
                </div>
            </div>

            <!-- Change Password -->
            <div class="card bg-base-100 shadow-xl mt-6">
                <div class="card-body">
                    <h2 class="card-title">Change Password</h2>

                    <form method="post" action="{% url 'account_change_password' %}" class="space-y-4">
                        {% csrf_token %}

                        {% if form.non_field_errors %}
                            <div class="alert alert-error">
                                {% for error in form.non_field_errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}

                        <div class="form-control">
                            <label for="{{ form.oldpassword.id_for_label }}" class="label">
                                <span class="label-text">Current Password</span>
                            </label>
                            <input
                                id="{{ form.oldpassword.id_for_label }}"
                                name="{{ form.oldpassword.name }}"
                                type="password"
                                class="input input-bordered"
                                required
                            >
                            {% if form.oldpassword.errors %}
                                <p class="mt-1 text-sm text-error">{{ form.oldpassword.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div class="form-control">
                            <label for="{{ form.password1.id_for_label }}" class="label">
                                <span class="label-text">New Password</span>
                            </label>
                            <input
                                id="{{ form.password1.id_for_label }}"
                                name="{{ form.password1.name }}"
                                type="password"
                                class="input input-bordered"
                                required
                            >
                            {% if form.password1.errors %}
                                <p class="mt-1 text-sm text-error">{{ form.password1.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div class="form-control">
                            <label for="{{ form.password2.id_for_label }}" class="label">
                                <span class="label-text">Confirm New Password</span>
                            </label>
                            <input
                                id="{{ form.password2.id_for_label }}"
                                name="{{ form.password2.name }}"
                                type="password"
                                class="input input-bordered"
                                required
                            >
                            {% if form.password2.errors %}
                                <p class="mt-1 text-sm text-error">{{ form.password2.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <div class="card-actions justify-end">
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Account Statistics -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Account Statistics</h2>

                    <div class="stats stats-vertical w-full">
                        <div class="stat">
                            <div class="stat-title">Total Loans</div>
                            <div class="stat-value text-primary">{{ user.loans.count }}</div>
                        </div>

                        <div class="stat">
                            <div class="stat-title">Active Plans</div>
                            <div class="stat-value text-secondary">{{ user.debt_plans.filter(is_active=True).count }}</div>
                        </div>

                        <div class="stat">
                            <div class="stat-title">Account Status</div>
                            <div class="stat-value text-sm">
                                {% if user.subscription.is_active %}
                                    <span class="text-success">Premium</span>
                                {% else %}
                                    <span class="text-warning">Free</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Quick Actions</h2>

                    <div class="space-y-2">
                        <a href="{% url 'loans:create' %}" class="btn btn-outline btn-block">
                            Add New Loan
                        </a>
                        <a href="{% url 'plans:list' %}" class="btn btn-outline btn-block">
                            View Debt Plans
                        </a>
                        <a href="{% url 'billing:subscription' %}" class="btn btn-outline btn-block">
                            Manage Subscription
                        </a>
                    </div>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="card bg-base-100 shadow-xl border-error">
                <div class="card-body">
                    <h2 class="card-title text-error">Danger Zone</h2>

                    <p class="text-sm text-base-content/70 mb-4">
                        Once you delete your account, there is no going back. Please be certain.
                    </p>

                    <button
                        class="btn btn-error btn-block"
                        onclick="confirmAccountDeletion()"
                    >
                        Delete Account
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function confirmAccountDeletion() {
    if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
        // Handle account deletion
        alert('Account deletion feature coming soon. Please contact support.');
    }
}
</script>
{% endblock %}