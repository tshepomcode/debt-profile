{% extends 'base/base.html' %}

{% block title %}Dashboard - Debt Profile{% endblock %}

{% block disclaimers %}
    {% include 'base/disclaimer.html' %}
    {% include 'base/privacy.html' %}
{% endblock %}

{% block content %}
<div class="min-h-screen bg-[#F8FAFC] p-6">
    <div class="max-w-7xl mx-auto">
        <!-- 3-Column Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

            <!-- Sidebar -->
            <div class="lg:col-span-3 space-y-6">
                <!-- Profile Card -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center space-x-4 mb-6">
                        <div class="w-12 h-12 bg-gradient-to-r from-violet-500 to-blue-500 rounded-full flex items-center justify-center text-white font-semibold">
                            {{ user.email|first|upper }}
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900">{{ user.email|truncatechars:15 }}</h3>
                            <p class="text-sm text-gray-500">
                                {% if user.subscription.is_active %}Premium{% else %}Free{% endif %} Plan
                            </p>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <nav class="space-y-2">
                        <a href="{% url 'loans:dashboard' %}" class="flex items-center space-x-3 p-3 rounded-xl bg-violet-50 text-violet-700 font-medium">
                            <span>üè†</span>
                            <span>Dashboard</span>
                        </a>
                        <a href="{% url 'loans:list' %}" class="flex items-center space-x-3 p-3 rounded-xl text-gray-600 hover:bg-gray-50">
                            <span>üí∞</span>
                            <span>My Loans</span>
                        </a>
                        <a href="{% url 'plans:compare' %}" class="flex items-center space-x-3 p-3 rounded-xl text-gray-600 hover:bg-gray-50">
                            <span>üìä</span>
                            <span>Debt Plans</span>
                        </a>
                        <a href="{% url 'billing:waiting-list-management' %}" class="flex items-center space-x-3 p-3 rounded-xl text-gray-600 hover:bg-gray-50">
                            <span>‚öôÔ∏è</span>
                            <span>Settings</span>
                        </a>
                    </nav>

                    <!-- Go Premium CTA -->
                    {% if not user.subscription.is_active %}
                    <div class="mt-6 p-4 bg-gradient-to-r from-[#4F46E5] to-[#60A5FA] rounded-xl text-white">
                        <h4 class="font-semibold mb-2">Go Premium</h4>
                        <p class="text-sm opacity-90 mb-3">Unlock advanced features</p>
                        <a href="{% url 'billing:waiting-list-management' %}" class="bg-white text-[#4F46E5] px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors">
                            Upgrade Now
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Main Content -->
            <div class="lg:col-span-6 space-y-6">
                <!-- Welcome Header -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h1 class="text-2xl font-bold text-gray-900 mb-2">
                        Welcome back, {{ user.email|truncatechars:20 }}!
                    </h1>
                    <p class="text-gray-600">
                        Here's your debt overview and progress
                    </p>
                </div>

                <!-- Wallet Card -->
                <div class="bg-gradient-to-r from-[#4F46E5] to-[#60A5FA] rounded-2xl p-6 text-white shadow-lg relative overflow-hidden">
                    <!-- Card background pattern -->
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"></div>
                    <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full -ml-12 -mb-12"></div>

                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <p class="text-white/80 text-sm font-medium mb-1">Total Debt Balance</p>
                                <h2 class="text-3xl font-bold">${{ total_balance|floatformat:0 }}</h2>
                            </div>
                            <div class="text-right">
                                <div class="text-white/60 text-xs mb-1">**** **** **** 4242</div>
                                <div class="text-white/80 text-xs">DEBT PROFILE</div>
                            </div>
                        </div>

                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-white/80 text-xs">Active Loans</p>
                                <p class="text-white font-semibold">{{ loan_count }}</p>
                            </div>
                            <div>
                                <p class="text-white/80 text-xs">Avg APR</p>
                                <p class="text-white font-semibold">{{ avg_rate|floatformat:1 }}%</p>
                            </div>
                            <div>
                                <p class="text-white/80 text-xs">Monthly Min</p>
                                <p class="text-white font-semibold">${{ total_payments|floatformat:0 }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Debt Breakdown Chart -->
                <div class="bg-white rounded-2xl p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-[#111827] mb-4">Debt Breakdown</h3>
                    <div class="chart-container">
                        <canvas id="debtChart" height="300"></canvas>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="bg-white rounded-2xl p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-[#111827] mb-4">Recent Transactions</h3>
                    {% if loans %}
                        <div class="space-y-4">
                            {% for loan in loans|slice:":5" %}
                                <div class="flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-[#4F46E5]/10 rounded-full flex items-center justify-center">
                                            <span class="text-[#4F46E5] font-semibold">{{ loan.name|first|upper }}</span>
                                        </div>
                                        <div>
                                            <h4 class="font-medium text-[#111827]">{{ loan.name }}</h4>
                                            <p class="text-sm text-[#6B7280]">{{ loan.creditor }} ‚Ä¢ {{ loan.created_at|date:"M j" }}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-red-600">-${{ loan.minimum_payment|floatformat:0 }}</p>
                                        <p class="text-sm text-[#6B7280]">Payment</p>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="mt-4 text-center">
                            <a href="{% url 'loans:list' %}" class="text-[#4F46E5] hover:text-[#4F46E5]/80 font-medium text-sm">
                                View all transactions ‚Üí
                            </a>
                        </div>
                    {% else %}
                        <div class="text-center py-8">
                            <div class="text-6xl mb-4">üí≥</div>
                            <h3 class="text-lg font-semibold mb-2 text-[#111827]">No transactions yet</h3>
                            <p class="text-[#6B7280] mb-4">Add your loans to start tracking payments and progress.</p>
                            <a href="{% url 'loans:create' %}" class="bg-[#4F46E5] text-white px-6 py-3 rounded-xl font-medium hover:bg-[#4F46E5]/90 transition-colors">
                                Add Your First Loan
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Right Panel -->
            <div class="lg:col-span-3 space-y-6">
                <!-- Expense Overview -->
                <div class="bg-white rounded-2xl p-6 shadow-lg">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-[#111827]">Expense Overview</h3>
                        <div class="tabs tabs-boxed bg-gray-100">
                            <a href="{% url 'loans:list' %}" class="tab tab-active text-sm">Expenses</a>
                        </div>
                    </div>

                    <div class="text-center mb-6">
                        <p class="text-[#6B7280] text-sm mb-1">Total Monthly Payments</p>
                        <p class="text-2xl font-bold text-[#111827]">${{ total_payments|floatformat:0 }}</p>
                    </div>

                    <!-- Expense Breakdown -->
                    <div class="space-y-3 mb-6">
                        {% for loan_type, amount in loan_type_breakdown.items %}
                        <div class="flex justify-between items-center">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 rounded-full bg-[#6366F1]"></div>
                                <span class="text-[#6B7280] text-sm">{{ loan_type|title }}</span>
                            </div>
                            <span class="font-medium text-[#111827]">${{ amount|floatformat:0 }}</span>
                        </div>
                        {% empty %}
                        <div class="flex justify-between items-center">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 rounded-full bg-[#6366F1]"></div>
                                <span class="text-[#6B7280] text-sm">No loans yet</span>
                            </div>
                            <span class="font-medium text-[#111827]">$0</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Weekly Payment Trend -->
                <div class="bg-white rounded-2xl p-6 shadow-lg">
                    <h3 class="text-lg font-semibold text-[#111827] mb-4">Weekly Payment Trend</h3>
                    <div class="chart-container">
                        <canvas id="paymentTrendChart" height="200"></canvas>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        <a href="{% url 'loans:create' %}" class="flex items-center justify-center space-x-2 w-full bg-[#4F46E5] text-white py-3 px-4 rounded-xl font-medium hover:bg-[#4F46E5]/90 transition-colors">
                            <span>‚ûï</span>
                            <span>Add New Loan</span>
                        </a>
                        <a href="{% url 'plans:compare' %}" class="flex items-center justify-center space-x-2 w-full bg-gray-100 text-gray-700 py-3 px-4 rounded-xl font-medium hover:bg-gray-200 transition-colors">
                            <span>üìä</span>
                            <span>View Plans</span>
                        </a>
                        <a href="{% url 'billing:waiting-list-management' %}" class="flex items-center justify-center space-x-2 w-full bg-gray-100 text-gray-700 py-3 px-4 rounded-xl font-medium hover:bg-gray-200 transition-colors">
                            <span>‚≠ê</span>
                            <span>Upgrade Plan</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Initialize charts
document.addEventListener('DOMContentLoaded', function() {
    const loanCount = parseInt("{{ loan_count }}") || 0;

    // Debt Breakdown Chart
    if (loanCount > 0) {
        // Sample data matching the expense categories from design spec
        const debtData = {
            labels: ['Credit Cards', 'Student Loans', 'Personal Loans'],
            values: [1200, 800, 400] // Monthly payments for each category
        };
        createDebtChart('debtChart', debtData);
    }

    // Payment Trend Chart (Weekly)
    const trendData = {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        values: [85.50, 92.30, 78.90, 122.50, 95.20, 110.80, 88.40]
    };
    createPaymentChart('paymentTrendChart', trendData);
});
</script>
{% endblock %}